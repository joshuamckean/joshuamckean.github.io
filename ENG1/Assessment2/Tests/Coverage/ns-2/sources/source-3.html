


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > GameLoop</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">group24.piazzapanic.game</a>
</div>

<h1>Coverage Summary for Class: GameLoop (group24.piazzapanic.game)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">GameLoop</td>
<td class="coverageStat">
  <span class="percent">
    10%
  </span>
  <span class="absValue">
    (1/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/70)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0.5%
  </span>
  <span class="absValue">
    (1/203)
  </span>
</td>
</tr>
  <tr>
    <td class="name">GameLoop$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$0NgW1THp</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$0WQYpe4v</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$3gkXJOBA</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$4I3U5vNw</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$4OwKwHRz</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$4YDnr1T3</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$5K0SU1fZ</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$645NoGrc</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$6sxRbA0w</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$7v1eMXOd</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$bmtPIhVC</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$BuxpvJbC</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$CTsKMIww</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$DAdnUyZV</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$EaMrzWnD</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$eBAkwCE9</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$Eo9zMMOT</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$EzJ4bcez</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$f7d2OTCM</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$FuD1k6Cl</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$GK3xBYHo</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$hN7b6HlS</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$IZJrc1Rt</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$K9kEHl7x</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$kkUzOSLk</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$lUCa7g5A</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$M3TtziPz</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$m6kV0VN6</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$MBGQwwhZ</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$mDAjaDyH</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$mgzNZwoe</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$N4VH0AWb</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$OAgh5y53</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$oAo6ixCC</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$ou3qStjY</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$pMzs1j6X</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$pOOshwK1</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$Q9UWMec5</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$QwbD4TO9</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$RysoFC8r</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$Shpfhq6c</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$Tq4WWjXb</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$TybsOfB6</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$uc6SMXco</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$ue5EfSMP</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$uvT2hhgB</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$vUa3SriE</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$wKFykZXY</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$x1dQqtKW</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$XDcEMWmN</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$XfWJQbQC</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$Xz4ocao2</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$y6X9erM3</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$ynmHvQSd</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$YoAXOgP2</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$z33axgev</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$Z48uVoxo</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$z660Hvj3</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$z8fAXb5H</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$zleQYKt8</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$zOM5KXUn</td>
  </tr>
  <tr>
    <td class="name">GameLoop$MockitoMock$67131572$auxiliary$ZW8uOddR</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    8.3%
  </span>
  <span class="absValue">
    (1/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/70)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0.5%
  </span>
  <span class="absValue">
    (1/206)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package group24.piazzapanic.game;
&nbsp;
&nbsp;import com.badlogic.gdx.Gdx;
&nbsp;import com.badlogic.gdx.Input;
&nbsp;import com.badlogic.gdx.graphics.Color;
&nbsp;import com.badlogic.gdx.scenes.scene2d.Actor;
&nbsp;import com.badlogic.gdx.scenes.scene2d.Group;
&nbsp;import com.badlogic.gdx.scenes.scene2d.Stage;
&nbsp;import com.badlogic.gdx.scenes.scene2d.ui.Label;
&nbsp;import com.badlogic.gdx.scenes.scene2d.ui.Label.LabelStyle;
&nbsp;import com.badlogic.gdx.scenes.scene2d.ui.TextButton;
&nbsp;import com.badlogic.gdx.scenes.scene2d.utils.ChangeListener;
&nbsp;import com.badlogic.gdx.utils.Align;
&nbsp;import com.badlogic.gdx.utils.ScreenUtils;
&nbsp;import group24.piazzapanic.Base;
&nbsp;import group24.piazzapanic.levelElements.stations.Station;
&nbsp;import group24.piazzapanic.maths.Vector2;
&nbsp;import group24.piazzapanic.ui.*;
&nbsp;
&nbsp;import java.io.FileNotFoundException;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Random;
&nbsp;import java.util.concurrent.ThreadLocalRandom;
&nbsp;
&nbsp;/**
&nbsp; * The GameLoop class is the main game loop. It handles setting up the game,
&nbsp; * spawning customers and the level, spawning players, the game score, and so on. It extends {@link Stage}.
&nbsp; */
&nbsp;public class GameLoop extends Stage {
&nbsp;    /** The game score */
&nbsp;    public Label scoreCounter; // was final changed bec of testings causes
&nbsp;    /** The player&#39;s money */
&nbsp;    public Label moneyCounter; // was final but changed it for testings
&nbsp;    /** The player&#39;s reputation */
&nbsp;    public Label reputationCounter;
&nbsp;    /** Price labels */
&nbsp;    public Label fryingStationPrice;
&nbsp;    public Label cuttingStationPrice;
&nbsp;    public Label bakingStationPrice;
&nbsp;    private final Label gameTimer;
&nbsp;    /** Var for storing positions in per frame calculations, making a new vector causes the funni (memory leak)*/
&nbsp;    private Vector2 curPosition;
&nbsp;
&nbsp;    /** The rows of stations. Done this way to avoid Z-level drawing issues */
&nbsp;    private final ArrayList&lt;Group&gt; rows;
&nbsp;
&nbsp;    /** The stations in the game level */
&nbsp;    private ArrayList&lt;Station&gt; stations;
&nbsp;
<b class="nc">&nbsp;    public int maxCustomers = StageFactory.scenarioCustomerAmount; //maximum number of customers to appear</b>
&nbsp;    public int totalCustomers; //number of customers spawned so far
&nbsp;    /** counter of customers for power ups */
<b class="fc">&nbsp;    public static int served_customers = 0;</b>
&nbsp;    /** Powerup Label */
&nbsp;    public Label activePowerup;
&nbsp;    /** Powerup Notification Timer */
<b class="nc">&nbsp;    public float notificationTime = 0f;</b>
&nbsp;    /**
&nbsp;     * GameLoop constructor, adds a score counter and sets up level data.
&nbsp;     */
<b class="nc">&nbsp;    public GameLoop() {</b>
<b class="nc">&nbsp;        GameData.gameTime = 0f;</b>
<b class="nc">&nbsp;        GameData.sinceLastSpawn = 13f;</b>
<b class="nc">&nbsp;        GameData.customers = new ArrayList&lt;Customer&gt;();</b>
<b class="nc">&nbsp;        totalCustomers = 0;</b>
<b class="nc">&nbsp;        this.rows = new ArrayList&lt;Group&gt;();</b>
<b class="nc">&nbsp;        this.stations = new ArrayList&lt;Station&gt;();</b>
&nbsp;        //Read level data from file, create stations and add them to the level
<b class="nc">&nbsp;        GameData.level = new Level(&quot;levels/Level 3&quot;);</b>
<b class="nc">&nbsp;        for (int y = GameData.level.getHeight() - 1; y &gt;= 0; y--) {</b>
<b class="nc">&nbsp;            Group group = new Group();</b>
<b class="nc">&nbsp;            for (int x = 0; x &lt; GameData.level.getWidth(); x++) {</b>
<b class="nc">&nbsp;                if (GameData.level.grid[x][y] != null) {</b>
&nbsp;
<b class="nc">&nbsp;                    group.addActor(GameData.level.grid[x][y]);</b>
<b class="nc">&nbsp;                    this.stations.add(GameData.level.grid[x][y]);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            this.addActor(group);</b>
<b class="nc">&nbsp;            this.rows.add(group);</b>
&nbsp;        }
&nbsp;        //Add pause button
<b class="nc">&nbsp;        TextButton pauseButton = WidgetFactory.createTextButton(FontHandler.textButtonFormat, Color.WHITE,</b>
&nbsp;                new Vector2(0.2, 0.93), &quot;PAUSE&quot;, Align.right);
<b class="nc">&nbsp;        pauseButton.getStyle().overFontColor = Color.BLUE;</b>
&nbsp;        //Create onclick function
<b class="nc">&nbsp;        pauseButton.addListener(new ChangeListener() {</b>
&nbsp;
&nbsp;            @Override
&nbsp;            public void changed(ChangeEvent event, Actor actor) {
<b class="nc">&nbsp;                System.out.print(&quot;Open Main&quot;);</b>
<b class="nc">&nbsp;                StageManager.setActiveStage(&quot;Pause&quot;);</b>
&nbsp;            }
&nbsp;
&nbsp;        });
<b class="nc">&nbsp;        this.addActor(pauseButton);</b>
&nbsp;
&nbsp;        //Player creation
&nbsp;
<b class="nc">&nbsp;        GameData.player = new Player(GameData.level.startX + 0.5, GameData.level.startY + 0.5,</b>
&nbsp;                GameData.initialChef1Animation, GameData.chef1Animations);
<b class="nc">&nbsp;        GameData.player1 = GameData.player;</b>
<b class="nc">&nbsp;        GameData.player2 = new Player(GameData.level.startX + 0.5, GameData.level.startY + 0.5,</b>
&nbsp;                GameData.initialChef2Animation, GameData.chef2Animations);
<b class="nc">&nbsp;        GameData.player3 = new Player(GameData.level.startX + 0.5, GameData.level.startY + 0.5,</b>
&nbsp;                GameData.initialChef3Animation, GameData.chef3Animations);
&nbsp;
<b class="nc">&nbsp;        this.addActor(GameData.player1);</b>
<b class="nc">&nbsp;        this.addActor(GameData.player2);</b>
<b class="nc">&nbsp;        this.addActor(GameData.player3);</b>
&nbsp;
<b class="nc">&nbsp;        this.curPosition = new Vector2(0, 0);</b>
&nbsp;        //Create score counter
<b class="nc">&nbsp;        LabelStyle style = new LabelStyle();</b>
<b class="nc">&nbsp;        style.font = FontHandler.subtitleFormat;</b>
<b class="nc">&nbsp;        style.fontColor = Color.WHITE;</b>
<b class="nc">&nbsp;        CharSequence count = Integer.toString(GameData.score);</b>
<b class="nc">&nbsp;        scoreCounter = new Label(count, style);</b>
<b class="nc">&nbsp;        Vector2 pos = new Vector2(0.95, 0.9); // Score counter position.</b>
<b class="nc">&nbsp;        scoreCounter.setPosition(pos.getAbsoluteX(), pos.getAbsoluteY(), Align.bottomLeft);</b>
<b class="nc">&nbsp;        this.addActor(scoreCounter);</b>
&nbsp;
&nbsp;        // Create timer
<b class="nc">&nbsp;        gameTimer = new Label(count, style);</b>
<b class="nc">&nbsp;        pos = new Vector2(0.05, 0.9); // Timer position.</b>
<b class="nc">&nbsp;        gameTimer.setPosition(pos.getAbsoluteX(), pos.getAbsoluteY(), Align.bottomRight);</b>
<b class="nc">&nbsp;        this.addActor(gameTimer);</b>
&nbsp;
&nbsp;        // Create powerup label
<b class="nc">&nbsp;        activePowerup = new Label(&quot;Error&quot;, style);</b>
<b class="nc">&nbsp;        pos = new Vector2(0.15, 0.5);</b>
<b class="nc">&nbsp;        activePowerup.setPosition(pos.getAbsoluteX(), pos.getAbsoluteY(), Align.bottomRight);</b>
&nbsp;
&nbsp;        //Create reputation counter
<b class="nc">&nbsp;        LabelStyle reputation = new LabelStyle();</b>
<b class="nc">&nbsp;        reputation.font = FontHandler.subtitleFormat;</b>
<b class="nc">&nbsp;        reputation.fontColor = Color.FOREST;</b>
<b class="nc">&nbsp;        CharSequence count2 = Integer.toString(GameData.reputation);</b>
<b class="nc">&nbsp;        reputationCounter = new Label(count2, reputation);</b>
<b class="nc">&nbsp;        Vector2 pos2 = new Vector2(0.95, 0.84); // Money counter position.</b>
<b class="nc">&nbsp;        reputationCounter.setPosition(pos2.getAbsoluteX(), pos2.getAbsoluteY(), Align.bottomLeft);</b>
<b class="nc">&nbsp;        this.addActor(reputationCounter);</b>
&nbsp;
&nbsp;        //Create money counter
<b class="nc">&nbsp;        LabelStyle money = new LabelStyle();</b>
<b class="nc">&nbsp;        money.font = FontHandler.subtitleFormat;</b>
<b class="nc">&nbsp;        money.fontColor = Color.YELLOW;</b>
<b class="nc">&nbsp;        CharSequence count3 = Integer.toString(GameData.money);</b>
<b class="nc">&nbsp;        moneyCounter = new Label(count3, money);</b>
<b class="nc">&nbsp;        Vector2 pos3 = new Vector2(0.95, 0.78); // Reputation counter position.</b>
<b class="nc">&nbsp;        moneyCounter.setPosition(pos3.getAbsoluteX(), pos3.getAbsoluteY(), Align.bottomLeft);</b>
<b class="nc">&nbsp;        this.addActor(moneyCounter);</b>
&nbsp;
<b class="nc">&nbsp;        CharSequence price = Integer.toString(GameData.stationCost);</b>
<b class="nc">&nbsp;        fryingStationPrice = new Label(price, money);</b>
<b class="nc">&nbsp;        Vector2 pos4 = new Vector2(0.5, 0.9); // 2nd frying station position.</b>
<b class="nc">&nbsp;        fryingStationPrice.setPosition(pos4.getAbsoluteX(), pos4.getAbsoluteY(), Align.bottomLeft);</b>
<b class="nc">&nbsp;        this.addActor(fryingStationPrice);</b>
&nbsp;
<b class="nc">&nbsp;        cuttingStationPrice = new Label(price, money);</b>
<b class="nc">&nbsp;        Vector2 pos5 = new Vector2(0.45, 0.9); // 2nd cutting station position.</b>
<b class="nc">&nbsp;        cuttingStationPrice.setPosition(pos5.getAbsoluteX(), pos5.getAbsoluteY(), Align.bottomLeft);</b>
<b class="nc">&nbsp;        this.addActor(cuttingStationPrice);</b>
&nbsp;
<b class="nc">&nbsp;        bakingStationPrice = new Label(price, money);</b>
<b class="nc">&nbsp;        Vector2 pos6 = new Vector2(0.4, 0.9); // 2nd baking station position.</b>
<b class="nc">&nbsp;        bakingStationPrice.setPosition(pos6.getAbsoluteX(), pos6.getAbsoluteY(), Align.bottomLeft);</b>
<b class="nc">&nbsp;        this.addActor(bakingStationPrice);</b>
&nbsp;
&nbsp;        //Create Inventory Panel
<b class="nc">&nbsp;        StageAnimation ChefAnimation = new StageAnimation(GameData.chef1Animations.get(&quot;IdleFrontSelected&quot;), 6, 6, 1,</b>
&nbsp;                new Vector2(0.9, 0.85), 50, 100);
<b class="nc">&nbsp;        StageAnimation ChefAnimation1 = new StageAnimation(GameData.chef2Animations.get(&quot;IdleFrontSelected&quot;), 6, 6, 1,</b>
&nbsp;                new Vector2(0.85, 0.85), 50, 100);
<b class="nc">&nbsp;        StageAnimation ChefAnimation2 = new StageAnimation(GameData.chef3Animations.get(&quot;IdleFrontSelected&quot;), 6, 6, 1,</b>
&nbsp;                new Vector2(0.875, 0.55), 50, 100);
&nbsp;
<b class="nc">&nbsp;        this.addActor(ChefAnimation);</b>
<b class="nc">&nbsp;        this.addActor(ChefAnimation1);</b>
<b class="nc">&nbsp;        this.addActor(ChefAnimation2);</b>
&nbsp;
&nbsp;        //Create customers
<b class="nc">&nbsp;        GameData.customerSpriteSheets = new ArrayList&lt;String&gt;(Arrays.asList(&quot;customers/customer_1_idle.png&quot;,</b>
&nbsp;                &quot;customers/customer_2_idle.png&quot;, &quot;customers/customer_3_idle.png&quot;));
<b class="nc">&nbsp;        GameData.rand = new Random();</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Adds a score to the score counter.
&nbsp;     * @param score The score to add (Integer)
&nbsp;     */
&nbsp;    public void addScore(int score) {
<b class="nc">&nbsp;        CharSequence count = Integer.toString(score);</b>
<b class="nc">&nbsp;        this.scoreCounter.setText(count);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Adds money to the money counter.
&nbsp;     * @param money The money to add (Integer)
&nbsp;     */
&nbsp;    public void addMoney(int money) {
<b class="nc">&nbsp;        CharSequence count = Integer.toString(money);</b>
<b class="nc">&nbsp;        this.moneyCounter.setText(count);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void loseReputation(int reputation) {
<b class="nc">&nbsp;        CharSequence count = Integer.toString(reputation);</b>
<b class="nc">&nbsp;        this.reputationCounter.setText(count);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addReputation(int reputation) {
<b class="nc">&nbsp;        CharSequence count = Integer.toString(reputation);</b>
<b class="nc">&nbsp;        this.reputationCounter.setText(count);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Spawns customers, handles swapping players and pausing game.
&nbsp;     * @param delta Time in seconds since the last frame.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void act(float delta) {
<b class="nc">&nbsp;        GameData.gameTime += delta;</b>
<b class="nc">&nbsp;        notificationTime += delta;</b>
<b class="nc">&nbsp;        Player.maxSpeed = Player.setSpeed();</b>
&nbsp;
&nbsp;        /** Instant complete customer order for debugging
&nbsp;        if (Gdx.input.isKeyJustPressed(Input.Keys.L)) {
&nbsp;            GameData.customers.get(0).fulfillOrder();
&nbsp;        }
&nbsp;        */
&nbsp;
<b class="nc">&nbsp;        if (!StageFactory.endlessModeEnabled) {</b>
<b class="nc">&nbsp;            if (this.totalCustomers &lt; this.maxCustomers) {</b>
<b class="nc">&nbsp;                GameData.sinceLastSpawn += delta;</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            GameData.sinceLastSpawn += delta;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (GameData.sinceLastSpawn &gt;= 15) {</b>
&nbsp;            // Creates 1 extra customer each time for every 2 minutes that have passed if in endless mode
<b class="nc">&nbsp;            if (StageFactory.endlessModeEnabled) {</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt;= Math.floor(GameData.gameTime / 120); i++) {</b>
&nbsp;                    //Create new customer offset location.
<b class="nc">&nbsp;                    Customer customer = new Customer();</b>
<b class="nc">&nbsp;                    customer.setX(GameData.customers.size() * (Customer.entityWidth + 30));</b>
<b class="nc">&nbsp;                    GameData.customers.add(customer);</b>
<b class="nc">&nbsp;                    this.addActor(customer);</b>
<b class="nc">&nbsp;                    this.totalCustomers++;</b>
&nbsp;                }
&nbsp;            } else {
&nbsp;                //Create new customer offset location.
<b class="nc">&nbsp;                Customer customer = new Customer();</b>
<b class="nc">&nbsp;                customer.setX(GameData.customers.size() * (Customer.entityWidth + 30));</b>
<b class="nc">&nbsp;                GameData.customers.add(customer);</b>
<b class="nc">&nbsp;                this.addActor(customer);</b>
<b class="nc">&nbsp;                this.totalCustomers++;</b>
&nbsp;            }
<b class="nc">&nbsp;            GameData.sinceLastSpawn = 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (Gdx.input.isKeyJustPressed(Base.SWAP_KEY)) {</b>
<b class="nc">&nbsp;            if (GameData.player == GameData.player1) {</b>
<b class="nc">&nbsp;                System.out.println(&quot;Swapping player 1 to 2&quot;);</b>
<b class="nc">&nbsp;                GameData.player = GameData.player2;</b>
<b class="nc">&nbsp;            } else if (GameData.player == GameData.player2) {</b>
<b class="nc">&nbsp;                System.out.println(&quot;Swapping player 2 to 3&quot;);</b>
<b class="nc">&nbsp;                GameData.player = GameData.player3;</b>
<b class="nc">&nbsp;            } else if (GameData.player == GameData.player3) {</b>
<b class="nc">&nbsp;                System.out.println(&quot;Swapping player 3 to 1&quot;);</b>
<b class="nc">&nbsp;                GameData.player = GameData.player1;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (Gdx.input.isKeyJustPressed(Base.PAUSE_KEY)) {</b>
<b class="nc">&nbsp;            StageManager.setActiveStage(&quot;Pause&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (Gdx.input.isKeyJustPressed(Base.SAVE_KEY)) {</b>
<b class="nc">&nbsp;            SaveLoad.save();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (Gdx.input.isKeyJustPressed(Base.LOAD_KEY)) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                SaveLoad.load();</b>
<b class="nc">&nbsp;            } catch (FileNotFoundException e) {</b>
<b class="nc">&nbsp;                System.out.println(&quot;No save file exists&quot;);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (Gdx.input.isKeyJustPressed(Base.POWERUP_KEY)) {</b>
<b class="nc">&nbsp;            if(served_customers &gt;= 3){</b>
<b class="nc">&nbsp;                served_customers = 0;</b>
<b class="nc">&nbsp;                notificationTime = 0;</b>
<b class="nc">&nbsp;                Power.up(GameData.rand.nextInt(5));</b>
<b class="nc">&nbsp;                System.out.println(GameData.rand.nextInt(5));</b>
&nbsp;            }
&nbsp;
&nbsp;        }
<b class="nc">&nbsp;        if (notificationTime &gt;= 3) {</b>
<b class="nc">&nbsp;            this.activePowerup.remove();</b>
<b class="nc">&nbsp;            notificationTime = 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (GameData.score == this.maxCustomers &amp;&amp; maxCustomers != 0 &amp;&amp; !StageFactory.endlessModeEnabled) {</b>
<b class="nc">&nbsp;            StageManager.setActiveStage(&quot;GameWin&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (GameData.reputation &lt;= 0) {</b>
<b class="nc">&nbsp;            if (!StageFactory.endlessModeEnabled){</b>
<b class="nc">&nbsp;                StageManager.setActiveStage(&quot;ScenarioGameOver&quot;);</b>
&nbsp;            }
&nbsp;            else {
<b class="nc">&nbsp;                StageManager.addStage(&quot;EndlessGameOver&quot;,StageFactory.createEndlessGameOverStage());</b>
<b class="nc">&nbsp;                StageManager.setActiveStage(&quot;EndlessGameOver&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;        // Run player movement and physics, it&#39;s quite long so I put it in a separate function.
<b class="nc">&nbsp;        CharSequence count = Integer.toString(Math.toIntExact((long) Math.floor(GameData.gameTime)));</b>
<b class="nc">&nbsp;        this.gameTimer.setText(count);</b>
<b class="nc">&nbsp;        Physics.playerMovement(GameData.player, delta);</b>
<b class="nc">&nbsp;        resortActors();</b>
<b class="nc">&nbsp;        super.act(delta);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Resorts the actors in the game loop to avoid Z-level drawing issues.
&nbsp;     * 
&nbsp;     */
&nbsp;    private void resortActors() {
<b class="nc">&nbsp;        int ylevel = 0;</b>
<b class="nc">&nbsp;        int offset = 0;</b>
<b class="nc">&nbsp;        for (Actor actor : this.rows) {</b>
<b class="nc">&nbsp;            if (GameData.level.getHeight() - 1 - ((int) Math.floor(GameData.player1.y)) == ylevel - offset) {</b>
<b class="nc">&nbsp;                GameData.player1.setZIndex(ylevel);</b>
<b class="nc">&nbsp;                offset++;</b>
<b class="nc">&nbsp;                ylevel++;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (GameData.level.getHeight() - 1 - ((int) Math.floor(GameData.player2.y)) == ylevel - offset) {</b>
<b class="nc">&nbsp;                GameData.player2.setZIndex(ylevel);</b>
<b class="nc">&nbsp;                offset++;</b>
<b class="nc">&nbsp;                ylevel++;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (GameData.level.getHeight() - 1 - ((int) Math.floor(GameData.player3.y)) == ylevel - offset) {</b>
<b class="nc">&nbsp;                GameData.player3.setZIndex(ylevel);</b>
<b class="nc">&nbsp;                offset++;</b>
<b class="nc">&nbsp;                ylevel++;</b>
&nbsp;            }
<b class="nc">&nbsp;            actor.setZIndex(ylevel);</b>
<b class="nc">&nbsp;            ylevel++;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Resorts the customers in the game loop to avoid Z-level drawing issues.
&nbsp;     */
&nbsp;    public void resortCustomers() {
<b class="nc">&nbsp;        int i = 0;</b>
<b class="nc">&nbsp;        for (Customer customer : GameData.customers) {</b>
<b class="nc">&nbsp;            customer.setX(i * (Customer.entityWidth + 30));</b>
<b class="nc">&nbsp;            i++;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws all level elements, floor tiles, players and customers.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void draw() {
&nbsp;
<b class="nc">&nbsp;        ScreenUtils.clear(0.8f, 0.8f, 0.8f, 1);</b>
&nbsp;
&nbsp;        // Iterate through level array and draw tiles.
&nbsp;        // Make sure the tiles are drawn first higher up the screen.
<b class="nc">&nbsp;        for (int y = GameData.level.getHeight() - 1; y &gt;= 0; y--) {</b>
<b class="nc">&nbsp;            for (int x = 0; x &lt; GameData.level.getWidth(); x++) {</b>
<b class="nc">&nbsp;                curPosition = Vector2.gridUnitTranslate(x, y);</b>
<b class="nc">&nbsp;                Base.batch.draw(GameData.floorTexture, curPosition.getAbsoluteX() + GameData.offsetX,</b>
<b class="nc">&nbsp;                        curPosition.getAbsoluteY() + GameData.offsetY, Base.tile_pixel_width, Base.tile_pixel_width);</b>
&nbsp;
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        //This code causes a slight memory leak
&nbsp;        if (Base.DEBUG) { // Draws the player&#39;s hitbox area.
&nbsp;            Vector2 bottomLeft = Vector2.gridUnitTranslate(GameData.player.x - Player.GRID_WIDTH / 2,
&nbsp;                    GameData.player.y - Player.GRID_WIDTH / 2);
&nbsp;            Vector2 topRight = Vector2.gridUnitTranslate(GameData.player.x + Player.GRID_WIDTH / 2,
&nbsp;                    GameData.player.y + Player.GRID_WIDTH / 2);
&nbsp;            Base.batch.draw(GameData.debugSquareTexture, bottomLeft.getAbsoluteX() + GameData.offsetX,
&nbsp;                    bottomLeft.getAbsoluteY() + GameData.offsetY, topRight.getAbsoluteX() - bottomLeft.getAbsoluteX(),
&nbsp;                    topRight.getAbsoluteY() - bottomLeft.getAbsoluteY());
&nbsp;        }
&nbsp;
&nbsp;        //Draw the player inventory
<b class="nc">&nbsp;        if (GameData.player1.holding != null) {</b>
<b class="nc">&nbsp;            curPosition.x = 0.9;</b>
<b class="nc">&nbsp;            curPosition.y = 0.85;</b>
&nbsp;            //curPosition = new Vector2(0.85, 0.85);
<b class="nc">&nbsp;            GameData.player1.holding.drawItemInventory(curPosition.getAbsoluteX(), curPosition.getAbsoluteY() - 50, 50,</b>
&nbsp;                    50);
&nbsp;        }
<b class="nc">&nbsp;        if (GameData.player2.holding != null) {</b>
<b class="nc">&nbsp;            curPosition.y = 0.85;</b>
<b class="nc">&nbsp;            curPosition.x = 0.85;</b>
<b class="nc">&nbsp;            GameData.player2.holding.drawItemInventory(curPosition.getAbsoluteX(), curPosition.getAbsoluteY() - 50, 50,</b>
&nbsp;                    50);
&nbsp;        }
<b class="nc">&nbsp;        if (GameData.player3.holding != null) {</b>
<b class="nc">&nbsp;            curPosition.y = 0.55;</b>
<b class="nc">&nbsp;            curPosition.x = 0.875;</b>
<b class="nc">&nbsp;            GameData.player3.holding.drawItemInventory(curPosition.getAbsoluteX(), curPosition.getAbsoluteY() - 50, 50,</b>
&nbsp;                    50);
&nbsp;        }
<b class="nc">&nbsp;        Base.batch.end();</b>
<b class="nc">&nbsp;        Base.batch.begin();</b>
<b class="nc">&nbsp;        super.draw(); //Draw stations and player</b>
<b class="nc">&nbsp;        Base.batch.end();</b>
<b class="nc">&nbsp;        Base.batch.begin();</b>
&nbsp;        //Draw items
<b class="nc">&nbsp;        for (Station station : this.stations) {</b>
<b class="nc">&nbsp;            if (station.item != null) {</b>
<b class="nc">&nbsp;                station.item.drawItem((int) (station.getX() + ((Base.tile_pixel_width / 3))),</b>
<b class="nc">&nbsp;                        (int) (station.getY() + (Base.tile_pixel_height / 2)), Base.tile_pixel_width / 2,</b>
&nbsp;                        Base.tile_pixel_width / 2);
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-03 01:57</div>
</div>
</body>
</html>
